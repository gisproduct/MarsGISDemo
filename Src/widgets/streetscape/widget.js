/* 2018-5-21 19:11:26 | 版权所有 火星科技 http://marsgis.cn  【联系我们QQ：516584683，微信：marsgis】 */
L.widget.bindClass(L.widget.BaseWidget.extend({map:null,options:{resources:["view.css","http://api.map.baidu.com/getscript?v=2.0&ak=3lyTGoSaiEo7Tt0803bfgMSN1FW53nws&services="],view:{type:"append",url:"view.html",parent:"body"}},winCreateOK:function(t,i){var e=this;$("#btn_streetscapeBar_close").click(function(){e.disableBase()})},markerXY:null,activate:function(){$("body").append('<div id="streetscapeView" style="position:absolute;right:0px;top:0px;border:1px solid #ccc;top: 0px;bottom: 0px;width:50%;overflow: hidden;"><div id="streetscapeMap" style="height:100%;width:100%;overflow: hidden;"></div></div>'),$("#centerDiv").css({position:"absolute",height:"100%",width:"50%"}),$(".no-print-view").hide(),this.invalidateSize();var t=this,i=setInterval(function(){null!=window.BMap&&(clearInterval(i),t.addSecondMap())},500);this.map.on("click",this.map_clickHandler,this),$(".leaflet-container").css("cursor","crosshair")},disable:function(){this.map.off("click",this.map_clickHandler,this),this.markerXY&&(this.markerXY.remove(),this.markerXY=null),this.panorama=null,$("#streetscapeView").remove(),$(".leaflet-container").css("cursor",""),$("#centerDiv").css({position:"",height:"100%",width:"100%"}),$(".no-print-view").show(),this.invalidateSize()},invalidateSize:function(){var t=this.map;setTimeout(function(){t.invalidateSize(!1)},100)},getBaiduPoint:function(t){var i=(t=this.map.convert2wgs(t))[1],e=t[0];return point=L.mars.pointconvert.wgs2bd([i,e]),{x:i=point[0],y:e=point[1]}},centerAt:function(t){var i=this.map.convert2map(t);null==this.markerXY?(this.markerXY=L.marker(i,{icon:L.icon({iconUrl:this.path+"img/streetimg.png",iconSize:[26,38],iconAnchor:[13,38]})}),this.map.addLayer(this.markerXY)):this.markerXY.setLatLng(i),this.map.centerAt(i)},panorama:null,addSecondMap:function(){var e=this,t=this.getBaiduPoint(this.map.getCenter()),a=new BMap.Panorama("streetscapeMap");a.setPosition(new BMap.Point(t.x,t.y)),a.setPov({heading:-40,pitch:6}),a.addEventListener("position_changed",function(t){var i=a.getPosition();i=L.mars.pointconvert.bd2wgs([i.lng,i.lat]),e.centerAt([i[1],i[0]])}),this.panorama=a},map_clickHandler:function(t){var i=this.getBaiduPoint(t.latlng);this.panorama&&this.panorama.setPosition(new BMap.Point(i.x,i.y))}}));