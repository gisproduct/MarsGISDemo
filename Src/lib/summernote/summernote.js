/* 2018-3-10 12:34:16 | 版权所有 火星科技 http://marsgis.cn  【联系我们QQ：516584683，微信：marsgis】 */
!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(window.jQuery)}(function(T){Array.prototype.reduce||(Array.prototype.reduce=function(e){var t,n=Object(this),o=n.length>>>0,i=0;if(2===arguments.length)t=arguments[1];else{for(;i<o&&!(i in n);)i++;if(o<=i)throw new TypeError("Reduce of empty array with no initial value");t=n[i++]}for(;i<o;i++)i in n&&(t=e(t,n[i],i,n));return t}),"function"!=typeof Array.prototype.filter&&(Array.prototype.filter=function(e){for(var t=Object(this),n=t.length>>>0,o=[],i=2<=arguments.length?arguments[1]:void 0,r=0;r<n;r++)if(r in t){var a=t[r];e.call(i,a,r,t)&&o.push(a)}return o});var n,t,i,r,a,s,o,e,l,d,c,u,f,h,v,p,g,m,b,C,y,k,x,w,N,S,F,P,I,L,E,M,A,R,D,H,B,U,z,O,j,K,q,W,V,_="function"==typeof define&&define.amd,G={isMac:-1<navigator.appVersion.indexOf("Mac"),isMSIE:-1<navigator.userAgent.indexOf("MSIE")||-1<navigator.userAgent.indexOf("Trident"),isFF:-1<navigator.userAgent.indexOf("Firefox"),jqueryVersion:parseFloat(T.fn.jquery),isSupportAmd:_,hasCodeMirror:_?require.specified("CodeMirror"):!!window.CodeMirror,isFontInstalled:function(e){var t="Comic Sans MS"===e?"Courier New":"Comic Sans MS",n=T("<div>").css({position:"absolute",left:"-9999px",top:"-9999px",fontSize:"200px"}).text("mmmmmmmmmwwwwwww").appendTo(document.body),o=n.css("fontFamily",t).width(),i=n.css("fontFamily",e+","+t).width();return n.remove(),o!==i},isW3CRangeSupport:!!document.createRange},J=(n=0,{eq:function(t){return function(e){return t===e}},eq2:function(e,t){return e===t},peq2:function(n){return function(e,t){return e[n]===t[n]}},ok:function(){return!0},fail:function(){return!1},self:function(e){return e},not:function(e){return function(){return!e.apply(e,arguments)}},and:function(t,n){return function(e){return t(e)&&n(e)}},uniqueId:function(e){var t=++n+"";return e?e+t:t},rect2bnd:function(e){var t=T(document);return{top:e.top+t.scrollTop(),left:e.left+t.scrollLeft(),width:e.right-e.left,height:e.bottom-e.top}},invertObject:function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t}}),Y={head:t=function(e){return e[0]},last:i=function(e){return e[e.length-1]},initial:function(e){return e.slice(0,e.length-1)},tail:r=function(e){return e.slice(1)},prev:function(e,t){var n=e.indexOf(t);return-1===n?null:e[n-1]},next:function(e,t){var n=e.indexOf(t);return-1===n?null:e[n+1]},find:function(e,t){for(var n=0,o=e.length;n<o;n++){var i=e[n];if(t(i))return i}},contains:a=function(e,t){return-1!==T.inArray(t,e)},all:function(e,t){for(var n=0,o=e.length;n<o;n++)if(!t(e[n]))return!1;return!0},sum:function(e,n){return n=n||J.self,e.reduce(function(e,t){return e+n(t)},0)},from:function(e){for(var t=[],n=-1,o=e.length;++n<o;)t[n]=e[n];return t},clusterBy:function(e,o){return e.length?r(e).reduce(function(e,t){var n=i(e);return o(i(n),t)?n[n.length]=t:e[e.length]=[t],e},[[t(e)]]):[]},compact:function(e){for(var t=[],n=0,o=e.length;n<o;n++)e[n]&&t.push(e[n]);return t},unique:function(e){for(var t=[],n=0,o=e.length;n<o;n++)a(t,e[n])||t.push(e[n]);return t}},Q=String.fromCharCode(160),Z=(s=function(e){return e&&T(e).hasClass("note-editable")},o=function(t){var e;if(t.hasClass("note-air-editor")){var n=Y.last(t.attr("id").split("-"));return{editor:function(){return t},holder:function(){return t.data("holder")},editable:function(){return t},popover:(e=function(e){return function(){return T(e+n)}})("#note-popover-"),handle:e("#note-handle-"),dialog:e("#note-dialog-")}}return{editor:function(){return t},holder:function(){return t.data("holder")},dropzone:(e=function(e){return function(){return t.find(e)}})(".note-dropzone"),toolbar:e(".note-toolbar"),editable:e(".note-editable"),codable:e(".note-codable"),statusbar:e(".note-statusbar"),popover:e(".note-popover"),handle:e(".note-handle"),dialog:e(".note-dialog")}},l=function(e){return e&&3===e.nodeType},d=function(e){return e&&/^BR|^IMG|^HR/.test(e.nodeName.toUpperCase())},c=function(e){return!s(e)&&(e&&/^DIV|^P|^LI|^H[1-7]/.test(e.nodeName.toUpperCase()))},u=(e=function(t){return t=t.toUpperCase(),function(e){return e&&e.nodeName.toUpperCase()===t}})("LI"),f=e("TABLE"),h=function(e){return!(m(e)||v(e)||c(e)||f(e)||g(e))},v=function(e){return e&&/^UL|^OL/.test(e.nodeName.toUpperCase())},p=function(e){return e&&/^TD|^TH/.test(e.nodeName.toUpperCase())},g=e("BLOCKQUOTE"),m=function(e){return p(e)||g(e)||s(e)},b=e("A"),C=e("BODY"),y=G.isMSIE?"&nbsp;":"<br>",k=function(e){return l(e)?e.nodeValue.length:e.childNodes.length},x=function(e){var t=k(e);return 0===t||!Z.isText(e)&&1===t&&e.innerHTML===y},w=function(e){d(e)||k(e)||(e.innerHTML=y)},N=function(e,t){for(;e;){if(t(e))return e;if(s(e))break;e=e.parentNode}return null},S=function(e,t){t=t||J.fail;var n=[];return N(e,function(e){return s(e)||n.push(e),t(e)}),n},F=function(e,t){t=t||J.fail;for(var n=[];e&&!t(e);)n.push(e),e=e.nextSibling;return n},P=function(e,t){var n=t.nextSibling,o=t.parentNode;return n?o.insertBefore(e,n):o.appendChild(e),e},I=function(n,e){return T.each(e,function(e,t){n.appendChild(t)}),n},L=function(e){return 0===e.offset},E=function(e){return e.offset===k(e.node)},M=function(e){for(var t=0;e=e.previousSibling;)t+=1;return t},A=function(e){return!!(e&&e.childNodes&&e.childNodes.length)},R=function(e,t){var n,o;if(0===e.offset){if(s(e.node))return null;n=e.node.parentNode,o=M(e.node)}else o=A(e.node)?(n=e.node.childNodes[e.offset-1],k(n)):(n=e.node,t?0:e.offset-1);return{node:n,offset:o}},D=function(e,t){var n,o;if(k(e.node)===e.offset){if(s(e.node))return null;n=e.node.parentNode,o=M(e.node)+1}else o=A(e.node)?(n=e.node.childNodes[e.offset],0):(n=e.node,t?k(e.node):e.offset+1);return{node:n,offset:o}},H=function(e,t){return e.node===t.node&&e.offset===t.offset},B=function(e,t){if(l(e.node))return L(e)?e.node:E(e)?e.node.nextSibling:e.node.splitText(e.offset);var n=e.node.childNodes[e.offset],o=P(e.node.cloneNode(!1),e.node);return I(o,F(n)),t||(w(e.node),w(o)),o},U=function(e,o,i){var t=S(o.node,J.eq(e));return t.length?1===t.length?B(o,i):t.reduce(function(e,t){var n=P(t.cloneNode(!1),t);return e===o.node&&(e=B(o,i)),I(n,F(e)),i||(w(t),w(n)),n}):null},z=function(e){return document.createElement(e)},O=function(e,t){if(e&&e.parentNode){if(e.removeNode)return e.removeNode(t);var n=e.parentNode;if(!t){var o,i,r=[];for(o=0,i=e.childNodes.length;o<i;o++)r.push(e.childNodes[o]);for(o=0,i=r.length;o<i;o++)n.insertBefore(r[o],e)}n.removeChild(e)}},j=e("TEXTAREA"),{NBSP_CHAR:Q,ZERO_WIDTH_NBSP_CHAR:"\ufeff",blank:y,emptyPara:"<p>"+y+"</p>",makePredByNodeName:e,isEditable:s,isControlSizing:function(e){return e&&T(e).hasClass("note-control-sizing")},buildLayoutInfo:o,makeLayoutInfo:function(e){var t,n=T(e).closest(".note-editor, .note-air-editor, .note-air-layout");return n.length?(t=n.is(".note-editor, .note-air-editor")?n:T("#note-editor-"+Y.last(n.attr("id").split("-"))),o(t)):null},isText:l,isVoid:d,isPara:c,isPurePara:function(e){return c(e)&&!u(e)},isInline:h,isBodyInline:function(e){return h(e)&&!N(e,c)},isBody:C,isParaInline:function(e){return h(e)&&!!N(e,c)},isList:v,isTable:f,isCell:p,isBlockquote:g,isBodyContainer:m,isAnchor:b,isDiv:e("DIV"),isLi:u,isBR:e("BR"),isSpan:e("SPAN"),isB:e("B"),isU:e("U"),isS:e("S"),isI:e("I"),isImg:e("IMG"),isTextarea:j,isEmpty:x,isEmptyAnchor:J.and(b,x),isClosestSibling:function(e,t){return e.nextSibling===t||e.previousSibling===t},withClosestSiblings:function(e,t){t=t||J.ok;var n=[];return e.previousSibling&&t(e.previousSibling)&&n.push(e.previousSibling),n.push(e),e.nextSibling&&t(e.nextSibling)&&n.push(e.nextSibling),n},nodeLength:k,isLeftEdgePoint:L,isRightEdgePoint:E,isEdgePoint:function(e){return L(e)||E(e)},isLeftEdgeOf:function(e,t){for(;e&&e!==t;){if(0!==M(e))return!1;e=e.parentNode}return!0},isRightEdgeOf:function(e,t){for(;e&&e!==t;){if(M(e)!==k(e.parentNode)-1)return!1;e=e.parentNode}return!0},prevPoint:R,nextPoint:D,isSamePoint:H,isVisiblePoint:function(e){if(l(e.node)||!A(e.node)||x(e.node))return!0;var t=e.node.childNodes[e.offset-1],n=e.node.childNodes[e.offset];return!(t&&!d(t)||n&&!d(n))},prevPointUntil:function(e,t){for(;e;){if(t(e))return e;e=R(e)}return null},nextPointUntil:function(e,t){for(;e;){if(t(e))return e;e=D(e)}return null},walkPoint:function(e,t,n,o){for(var i=e;i&&(n(i),!H(i,t));){var r=o&&e.node!==i.node&&t.node!==i.node;i=D(i,r)}},ancestor:N,singleChildAncestor:function(e,t){for(e=e.parentNode;e&&1===k(e);){if(t(e))return e;if(s(e))break;e=e.parentNode}return null},listAncestor:S,lastAncestor:function(e,t){var n=S(e);return Y.last(n.filter(t))},listNext:F,listPrev:function(e,t){t=t||J.fail;for(var n=[];e&&!t(e);)n.push(e),e=e.previousSibling;return n},listDescendant:function(i,r){var a=[];return r=r||J.ok,function e(t){i!==t&&r(t)&&a.push(t);for(var n=0,o=t.childNodes.length;n<o;n++)e(t.childNodes[n])}(i),a},commonAncestor:function(e,t){for(var n=S(e),o=t;o;o=o.parentNode)if(-1<T.inArray(o,n))return o;return null},wrap:function(e,t){var n=e.parentNode,o=T("<"+t+">")[0];return n.insertBefore(o,e),o.appendChild(e),o},insertAfter:P,appendChildNodes:I,position:M,hasChildren:A,makeOffsetPath:function(e,t){var n=S(t,J.eq(e));return T.map(n,M).reverse()},fromOffsetPath:function(e,t){for(var n=e,o=0,i=t.length;o<i;o++)n=n.childNodes.length<=t[o]?n.childNodes[n.childNodes.length-1]:n.childNodes[t[o]];return n},splitTree:U,splitPoint:function(e,t){var n,o,i=t?c:m,r=S(e.node,i),a=Y.last(r)||e.node;return o=i(a)?(n=r[r.length-2],a):(n=a).parentNode,{rightNode:n&&U(n,e,t),container:o}},create:z,createText:function(e){return document.createTextNode(e)},remove:O,removeWhile:function(e,t){for(;e&&!s(e)&&t(e);){var n=e.parentNode;O(e),e=n}},replace:function(e,t){if(e.nodeName.toUpperCase()===t.toUpperCase())return e;var n=z(t);return e.style.cssText&&(n.style.cssText=e.style.cssText),I(n,Y.from(e.childNodes)),P(n,e),O(e),n},html:function(e,t){var n=j(e[0])?e.val():e.html();return t&&(n=n.replace(/<(\/?)(\b(?!!)[^>\s]*)(.*?)(\s*\/?>)/g,function(e,t,n){n=n.toUpperCase();var o=/^DIV|^TD|^TH|^P|^LI|^H[1-7]/.test(n)&&!!t,i=/^BLOCKQUOTE|^TABLE|^TBODY|^TR|^HR|^UL|^OL/.test(n);return e+(o||i?"\n":"")}),n=T.trim(n)),n},value:function(e,t){var n=e.val();return t?n.replace(/[\n\r]/g,""):n}}),X=(K=function(e,t){var n,o,i=e.parentElement(),r=document.body.createTextRange(),a=Y.from(i.childNodes);for(n=0;n<a.length;n++)if(!Z.isText(a[n])){if(r.moveToElementText(a[n]),0<=r.compareEndPoints("StartToStart",e))break;o=a[n]}if(0!==n&&Z.isText(a[n-1])){var s=document.body.createTextRange(),l=null;s.moveToElementText(o||i),s.collapse(!o),l=o?o.nextSibling:i.firstChild;var d=e.duplicate();d.setEndPoint("StartToStart",s);for(var c=d.text.replace(/[\r\n]/g,"").length;c>l.nodeValue.length&&l.nextSibling;)c-=l.nodeValue.length,l=l.nextSibling;l.nodeValue;t&&l.nextSibling&&Z.isText(l.nextSibling)&&c===l.nodeValue.length&&(c-=l.nodeValue.length,l=l.nextSibling),i=l,n=c}return{cont:i,offset:n}},q=function(e){var a=function(e,t){var n,o;if(Z.isText(e)){var i=Z.listPrev(e,J.not(Z.isText)),r=Y.last(i).previousSibling;n=r||e.parentNode,t+=Y.sum(Y.tail(i),Z.nodeLength),o=!r}else{if(n=e.childNodes[t]||e,Z.isText(n))return a(n,0);t=0,o=!1}return{node:n,collapseToStart:o,offset:t}},t=document.body.createTextRange(),n=a(e.node,e.offset);return t.moveToElementText(n.node),t.collapse(n.collapseToStart),t.moveStart("character",n.offset),t},W=function(i,r,a,s){this.sc=i,this.so=r,this.ec=a,this.eo=s;var n=function(){if(G.isW3CRangeSupport){var e=document.createRange();return e.setStart(i,r),e.setEnd(a,s),e}var t=q({node:i,offset:r});return t.setEndPoint("EndToEnd",q({node:a,offset:s})),t};this.getPoints=function(){return{sc:i,so:r,ec:a,eo:s}},this.getStartPoint=function(){return{node:i,offset:r}},this.getEndPoint=function(){return{node:a,offset:s}},this.select=function(){var e=n();if(G.isW3CRangeSupport){var t=document.getSelection();0<t.rangeCount&&t.removeAllRanges(),t.addRange(e)}else e.select()},this.normalize=function(){var e=function(e){return Z.isVisiblePoint(e)||(e=Z.isLeftEdgePoint(e)?Z.nextPointUntil(e,Z.isVisiblePoint):Z.prevPointUntil(e,Z.isVisiblePoint)),e},t=e(this.getStartPoint()),n=e(this.getEndPoint());return new W(t.node,t.offset,n.node,n.offset)},this.nodes=function(n,e){n=n||J.ok;var o=e&&e.includeAncestor,i=e&&e.fullyContains,t=this.getStartPoint(),r=this.getEndPoint(),a=[],s=[];return Z.walkPoint(t,r,function(e){var t;Z.isEditable(e.node)||(i?(Z.isLeftEdgePoint(e)&&s.push(e.node),Z.isRightEdgePoint(e)&&Y.contains(s,e.node)&&(t=e.node)):t=o?Z.ancestor(e.node,n):e.node,t&&n(t)&&a.push(t))},!0),Y.unique(a)},this.commonAncestor=function(){return Z.commonAncestor(i,a)},this.expand=function(e){var t=Z.ancestor(i,e),n=Z.ancestor(a,e);if(!t&&!n)return new W(i,r,a,s);var o=this.getPoints();return t&&(o.sc=t,o.so=0),n&&(o.ec=n,o.eo=Z.nodeLength(n)),new W(o.sc,o.so,o.ec,o.eo)},this.collapse=function(e){return e?new W(i,r,i,r):new W(a,s,a,s)},this.splitText=function(){var e=i===a,t=this.getPoints();return Z.isText(a)&&!Z.isEdgePoint(this.getEndPoint())&&a.splitText(s),Z.isText(i)&&!Z.isEdgePoint(this.getStartPoint())&&(t.sc=i.splitText(r),t.so=0,e&&(t.ec=t.sc,t.eo=s-r)),new W(t.sc,t.so,t.ec,t.eo)},this.deleteContents=function(){if(this.isCollapsed())return this;var e=this.splitText(),t=e.nodes(null,{fullyContains:!0}),o=Z.prevPointUntil(e.getStartPoint(),function(e){return!Y.contains(t,e.node)}),i=[];return T.each(t,function(e,t){var n=t.parentNode;o.node!==n&&1===Z.nodeLength(n)&&i.push(n),Z.remove(t,!1)}),T.each(i,function(e,t){Z.remove(t,!1)}),new W(o.node,o.offset,o.node,o.offset).normalize()};var e=function(t){return function(){var e=Z.ancestor(i,t);return!!e&&e===Z.ancestor(a,t)}};this.isOnEditable=e(Z.isEditable),this.isOnList=e(Z.isList),this.isOnAnchor=e(Z.isAnchor),this.isOnCell=e(Z.isCell),this.isLeftEdgeOf=function(e){if(!Z.isLeftEdgePoint(this.getStartPoint()))return!1;var t=Z.ancestor(this.sc,e);return t&&Z.isLeftEdgeOf(this.sc,t)},this.isCollapsed=function(){return i===a&&r===s},this.wrapBodyInlineWithPara=function(){if(Z.isBodyContainer(i)&&Z.isEmpty(i))return i.innerHTML=Z.emptyPara,new W(i.firstChild,0,i.firstChild,0);if(Z.isParaInline(i)||Z.isPara(i))return this.normalize();var e;if(Z.isInline(i)){var t=Z.listAncestor(i,J.not(Z.isInline));e=Y.last(t),Z.isInline(e)||(e=t[t.length-2]||i.childNodes[r])}else e=i.childNodes[0<r?r-1:0];var n=Z.listPrev(e,Z.isParaInline).reverse();if((n=n.concat(Z.listNext(e.nextSibling,Z.isParaInline))).length){var o=Z.wrap(Y.head(n),"p");Z.appendChildNodes(o,Y.tail(n))}return this.normalize()},this.insertNode=function(e){var t=this.wrapBodyInlineWithPara().deleteContents(),n=Z.splitPoint(t.getStartPoint(),Z.isInline(e));return n.rightNode?n.rightNode.parentNode.insertBefore(e,n.rightNode):n.container.appendChild(e),e},this.toString=function(){var e=n();return G.isW3CRangeSupport?e.toString():e.text},this.bookmark=function(e){return{s:{path:Z.makeOffsetPath(e,i),offset:r},e:{path:Z.makeOffsetPath(e,a),offset:s}}},this.paraBookmark=function(e){return{s:{path:Y.tail(Z.makeOffsetPath(Y.head(e),i)),offset:r},e:{path:Y.tail(Z.makeOffsetPath(Y.last(e),a)),offset:s}}},this.getClientRects=function(){return n().getClientRects()}},{create:function(e,t,n,o){if(arguments.length)2===arguments.length&&(n=e,o=t);else if(G.isW3CRangeSupport){var i=document.getSelection();if(0===i.rangeCount)return null;if(Z.isBody(i.anchorNode))return null;var r=i.getRangeAt(0);e=r.startContainer,t=r.startOffset,n=r.endContainer,o=r.endOffset}else{var a=document.selection.createRange(),s=a.duplicate();s.collapse(!1);var l=a;l.collapse(!0);var d=K(l,!0),c=K(s,!1);Z.isText(d.node)&&Z.isLeftEdgePoint(d)&&Z.isTextNode(c.node)&&Z.isRightEdgePoint(c)&&c.node.nextSibling===d.node&&(d=c),e=d.cont,t=d.offset,n=c.cont,o=c.offset}return new W(e,t,n,o)},createFromNode:function(e){var t=e,n=0,o=e,i=Z.nodeLength(o);return Z.isVoid(t)&&(n=Z.listPrev(t).length-1,t=t.parentNode),Z.isBR(o)?(i=Z.listPrev(o).length-1,o=o.parentNode):Z.isVoid(o)&&(i=Z.listPrev(o).length,o=o.parentNode),this.create(t,n,o,i)},createFromBookmark:function(e,t){var n=Z.fromOffsetPath(e,t.s.path),o=t.s.offset,i=Z.fromOffsetPath(e,t.e.path),r=t.e.offset;return new W(n,o,i,r)},createFromParaBookmark:function(e,t){var n=e.s.offset,o=e.e.offset,i=Z.fromOffsetPath(Y.head(t),e.s.path),r=Z.fromOffsetPath(Y.last(t),e.e.path);return new W(i,n,r,o)}}),$={readFileAsDataURL:function(e){return T.Deferred(function(n){T.extend(new FileReader,{onload:function(e){var t=e.target.result;n.resolve(t)},onerror:function(){n.reject(this)}}).readAsDataURL(e)}).promise()},createImage:function(n,o){return T.Deferred(function(e){var t=T("<img>");t.one("load",function(){t.off("error abort"),e.resolve(t)}).one("error abort",function(){t.off("load").detach(),e.reject(t)}).css({display:"none"}).appendTo(document.body).attr({src:n,"data-filename":o})}).promise()}},ee={isEdit:function(e){return Y.contains([8,9,13,32],e)},nameFromCode:{8:"BACKSPACE",9:"TAB",13:"ENTER",32:"SPACE",48:"NUM0",49:"NUM1",50:"NUM2",51:"NUM3",52:"NUM4",53:"NUM5",54:"NUM6",55:"NUM7",56:"NUM8",66:"B",69:"E",73:"I",74:"J",75:"K",76:"L",82:"R",83:"S",85:"U",89:"Y",90:"Z",191:"SLASH",219:"LEFTBRACKET",220:"BACKSLASH",221:"RIGHTBRACKET"}},te=function(t){var n=[],o=-1,i=t[0],e=function(e){null!==e.contents&&t.html(e.contents),null!==e.bookmark&&X.createFromBookmark(i,e.bookmark).select()};this.undo=function(){0<o&&e(n[--o])},this.redo=function(){n.length-1>o&&e(n[++o])},this.recordUndo=function(){var e;o++,n.length>o&&(n=n.slice(0,o)),n.push((e=X.create(),{contents:t.html(),bookmark:e?e.bookmark(i):{s:{path:[],offset:0},e:{path:[],offset:0}}}))},this.recordUndo()},ne=function(){this.stylePara=function(e,n){T.each(e.nodes(Z.isPara,{includeAncestor:!0}),function(e,t){T(t).css(n)})},this.styleNodes=function(e,t){e=e.splitText();var n=t&&t.nodeName||"SPAN",o=!(!t||!t.expandClosestSibling),i=!(!t||!t.onlyPartialContains);if(e.isCollapsed())return e.insertNode(Z.create(n));var r=Z.makePredByNodeName(n),a=T.map(e.nodes(Z.isText,{fullyContains:!0}),function(e){return Z.singleChildAncestor(e,r)||Z.wrap(e,n)});if(o){if(i){var s=e.nodes();r=J.and(r,function(e){return Y.contains(s,e)})}return T.map(a,function(e){var t=Z.withClosestSiblings(e,r),n=Y.head(t),o=Y.tail(t);return T.each(o,function(e,t){Z.appendChildNodes(n,t.childNodes),Z.remove(t)}),Y.head(t)})}return a},this.current=function(e,t){var n=function(n,e){if(G.jqueryVersion<1.9){var o={};return T.each(e,function(e,t){o[t]=n.css(t)}),o}return n.css.call(n,e)}(T(Z.isText(e.sc)?e.sc.parentNode:e.sc),["font-family","font-size","text-align","list-style-type","line-height"])||{};if(n["font-size"]=parseInt(n["font-size"],10),n["font-bold"]=document.queryCommandState("bold")?"bold":"normal",n["font-italic"]=document.queryCommandState("italic")?"italic":"normal",n["font-underline"]=document.queryCommandState("underline")?"underline":"normal",n["font-strikethrough"]=document.queryCommandState("strikeThrough")?"strikethrough":"normal",n["font-superscript"]=document.queryCommandState("superscript")?"superscript":"normal",n["font-subscript"]=document.queryCommandState("subscript")?"subscript":"normal",e.isOnList()){var o=-1<T.inArray(n["list-style-type"],["circle","disc","disc-leading-zero","square"]);n["list-style"]=o?"unordered":"ordered"}else n["list-style"]="none";var i=Z.ancestor(e.sc,Z.isPara);if(i&&i.style["line-height"])n["line-height"]=i.style.lineHeight;else{var r=parseInt(n["line-height"],10)/parseInt(n["font-size"],10);n["line-height"]=r.toFixed(1)}return n.image=Z.isImg(t)&&t,n.anchor=e.isOnAnchor()&&Z.ancestor(e.sc,Z.isAnchor),n.ancestors=Z.listAncestor(e.sc,Z.isEditable),n.range=e,n}},oe=function(){this.insertTab=function(e,t,n){var o=Z.createText(new Array(n+1).join(Z.NBSP_CHAR));(t=t.deleteContents()).insertNode(o,!0),(t=X.create(o,n)).select()},this.insertParagraph=function(){var e=X.create();e=(e=e.deleteContents()).wrapBodyInlineWithPara();var t,n=Z.ancestor(e.sc,Z.isPara);if(n){t=Z.splitTree(n,e.getStartPoint());var o=Z.listDescendant(n,Z.isEmptyAnchor);o=o.concat(Z.listDescendant(t,Z.isEmptyAnchor)),T.each(o,function(e,t){Z.remove(t)})}else{var i=e.sc.childNodes[e.so];t=T(Z.emptyPara)[0],i?e.sc.insertBefore(t,i):e.sc.appendChild(t)}X.create(t,0).normalize().select()}},ie=function(){this.tab=function(e,t){var n=Z.ancestor(e.commonAncestor(),Z.isCell),o=Z.ancestor(n,Z.isTable),i=Z.listDescendant(o,Z.isCell),r=Y[t?"prev":"next"](i,n);r&&X.create(r,0).select()},this.createTable=function(e,t){for(var n,o=[],i=0;i<e;i++)o.push("<td>"+Z.blank+"</td>");n=o.join("");for(var r,a=[],s=0;s<t;s++)a.push("<tr>"+n+"</tr>");return r=a.join(""),T('<table class="table table-bordered">'+r+"</table>")[0]}},re=function(){this.insertOrderedList=function(){this.toggleList("OL")},this.insertUnorderedList=function(){this.toggleList("UL")},this.indent=function(){var o=this,e=X.create().wrapBodyInlineWithPara(),t=e.nodes(Z.isPara,{includeAncestor:!0}),n=Y.clusterBy(t,J.peq2("parentNode"));T.each(n,function(e,t){var n=Y.head(t);Z.isLi(n)?o.wrapList(t,n.parentNode.nodeName):T.each(t,function(e,t){T(t).css("marginLeft",function(e,t){return(parseInt(t,10)||0)+25})})}),e.select()},this.outdent=function(){var o=this,e=X.create().wrapBodyInlineWithPara(),t=e.nodes(Z.isPara,{includeAncestor:!0}),n=Y.clusterBy(t,J.peq2("parentNode"));T.each(n,function(e,t){var n=Y.head(t);Z.isLi(n)?o.releaseList([t]):T.each(t,function(e,t){T(t).css("marginLeft",function(e,t){return 25<(t=parseInt(t,10)||0)?t-25:""})})}),e.select()},this.toggleList=function(n){var o=this,e=X.create().wrapBodyInlineWithPara(),t=e.nodes(Z.isPara,{includeAncestor:!0}),i=e.paraBookmark(t),r=Y.clusterBy(t,J.peq2("parentNode"));if(Y.find(t,Z.isPurePara)){var a=[];T.each(r,function(e,t){a=a.concat(o.wrapList(t,n))}),t=a}else{var s=e.nodes(Z.isList,{includeAncestor:!0}).filter(function(e){return!T.nodeName(e,n)});s.length?T.each(s,function(e,t){Z.replace(t,n)}):t=this.releaseList(r,!0)}X.createFromParaBookmark(i,t).select()},this.wrapList=function(e,t){var n=Y.head(e),o=Y.last(e),i=Z.isList(n.previousSibling)&&n.previousSibling,r=Z.isList(o.nextSibling)&&o.nextSibling,a=i||Z.insertAfter(Z.create(t||"UL"),o);return e=T.map(e,function(e){return Z.isPurePara(e)?Z.replace(e,"LI"):e}),Z.appendChildNodes(a,e),r&&(Z.appendChildNodes(a,Y.from(r.childNodes)),Z.remove(r)),e},this.releaseList=function(e,l){var d=[];return T.each(e,function(e,t){var n=Y.head(t),o=Y.last(t),i=l?Z.lastAncestor(n,Z.isList):n.parentNode,r=1<i.childNodes.length?Z.splitTree(i,{node:o.parentNode,offset:Z.position(o)+1},!0):null,a=Z.splitTree(i,{node:n.parentNode,offset:Z.position(n)},!0);t=l?Z.listDescendant(a,Z.isLi):Y.from(a.childNodes).filter(Z.isLi),!l&&Z.isList(i.parentNode)||(t=T.map(t,function(e){return Z.replace(e,"P")})),T.each(Y.from(t).reverse(),function(e,t){Z.insertAfter(t,i)});var s=Y.compact([i,a,r]);T.each(s,function(e,t){var n=[t].concat(Z.listDescendant(t,Z.isList));T.each(n.reverse(),function(e,t){Z.nodeLength(t)||Z.remove(t,!0)})}),d=d.concat(t)}),d}},ae=function(){var u=new ne,i=new ie,o=new oe,t=new re;this.createRange=function(e){return e.focus(),X.create()},this.saveRange=function(e,t){e.focus(),e.data("range",X.create()),t&&X.create().collapse().select()},this.saveNode=function(e){for(var t=[],n=0,o=e[0].childNodes.length;n<o;n++)t.push(e[0].childNodes[n]);e.data("childNodes",t)},this.restoreRange=function(e){var t=e.data("range");t&&(t.select(),e.focus())},this.restoreNode=function(e){e.html("");for(var t=e.data("childNodes"),n=0,o=t.length;n<o;n++)e[0].appendChild(t[n])},this.currentStyle=function(e){var t=X.create();return!!t&&(t.isOnEditable()&&u.current(t,e))};var n=this.triggerOnBeforeChange=function(e){var t=e.data("callbacks").onBeforeChange;t&&t(e.html(),e)},r=this.triggerOnChange=function(e){var t=e.data("callbacks").onChange;t&&t(e.html(),e)};this.undo=function(e){n(e),e.data("NoteHistory").undo(),r(e)},this.redo=function(e){n(e),e.data("NoteHistory").redo(),r(e)};for(var f=this.beforeCommand=function(e){n(e)},h=this.afterCommand=function(e){e.data("NoteHistory").recordUndo(),r(e)},e=["bold","italic","underline","strikethrough","superscript","subscript","justifyLeft","justifyCenter","justifyRight","justifyFull","formatBlock","removeFormat","backColor","foreColor","insertHorizontalRule","fontName"],a=0,s=e.length;a<s;a++)this[e[a]]=function(n){return function(e,t){f(e),document.execCommand(n,!1,t),h(e)}}(e[a]);this.tab=function(e,t){var n=X.create();n.isCollapsed()&&n.isOnCell()?i.tab(n):(f(e),o.insertTab(e,n,t.tabsize),h(e))},this.untab=function(){var e=X.create();e.isCollapsed()&&e.isOnCell()&&i.tab(e,!0)},this.insertParagraph=function(e){f(e),o.insertParagraph(e),h(e)},this.insertOrderedList=function(e){f(e),t.insertOrderedList(e),h(e)},this.insertUnorderedList=function(e){f(e),t.insertUnorderedList(e),h(e)},this.indent=function(e){f(e),t.indent(e),h(e)},this.outdent=function(e){f(e),t.outdent(e),h(e)},this.insertImage=function(t,e,n){$.createImage(e,n).then(function(e){f(t),e.css({display:"",width:Math.min(t.width(),e.width())}),X.create().insertNode(e[0]),X.createFromNode(e[0]).collapse().select(),h(t)}).fail(function(){var e=t.data("callbacks");e.onImageUploadError&&e.onImageUploadError()})},this.insertNode=function(e,t){f(e),this.createRange(e).insertNode(t),X.createFromNode(t).collapse().select(),h(e)},this.insertText=function(e,t){f(e);var n=this.createRange(e).insertNode(Z.createText(t));X.create(n,Z.nodeLength(n)).select(),h(e)},this.formatBlock=function(e,t){f(e),t=G.isMSIE?"<"+t+">":t,document.execCommand("FormatBlock",!1,t),h(e)},this.formatPara=function(e){f(e),this.formatBlock(e,"P"),h(e)};for(a=1;a<=6;a++)this["formatH"+a]=function(t){return function(e){this.formatBlock(e,"H"+t)}}(a);this.fontSize=function(e,n){f(e);var t=this.createRange(e),o=u.styleNodes(t);T.each(o,function(e,t){T(t).css({"font-size":n+"px"})}),h(e)},this.lineHeight=function(e,t){f(e),u.stylePara(X.create(),{lineHeight:t}),h(e)},this.unlink=function(e){var t=X.create();if(t.isOnAnchor()){var n=Z.ancestor(t.sc,Z.isAnchor);(t=X.createFromNode(n)).select(),f(e),document.execCommand("unlink"),h(e)}},this.createLink=function(e,t,n){var o,i=t.url,r=t.text,a=t.newWindow,s=t.range,l=s.toString()!==r;(f(e),n.onCreateLink&&(i=n.onCreateLink(i)),l)?o=[s.insertNode(T("<A>"+r+"</A>")[0])]:o=u.styleNodes(s,{nodeName:"A",expandClosestSibling:!0,onlyPartialContains:!0});T.each(o,function(e,t){T(t).attr("href",i),a?T(t).attr("target","_blank"):T(t).removeAttr("target")});var d=X.createFromNode(Y.head(o)).collapse(!0).getStartPoint(),c=X.createFromNode(Y.last(o)).collapse().getEndPoint();X.create(d.node,d.offset,c.node,c.offset).select(),h(e)},this.getLinkInfo=function(e){e.focus();var t=X.create().expand(Z.isAnchor),n=T(Y.head(t.nodes(Z.isAnchor)));return{range:t,text:t.toString(),isNewWindow:!!n.length&&"_blank"===n.attr("target"),url:n.length?n.attr("href"):""}},this.color=function(e,t){var n=JSON.parse(t),o=n.foreColor,i=n.backColor;f(e),o&&document.execCommand("foreColor",!1,o),i&&document.execCommand("backColor",!1,i),h(e)},this.insertTable=function(e,t){var n=t.split("x");f(e);var o=X.create();(o=o.deleteContents()).insertNode(i.createTable(n[0],n[1])),h(e)},this.floatMe=function(e,t,n){f(e),n.css("float",t),h(e)},this.imageShape=function(e,t,n){f(e),n.removeClass("img-rounded img-circle img-thumbnail"),t&&n.addClass(t),h(e)},this.resize=function(e,t,n){f(e),n.css({width:100*t+"%",height:""}),h(e)},this.resizeTo=function(e,t,n){var o;if(n){var i=e.y/e.x,r=t.data("ratio");o={width:i<r?e.x:e.y/r,height:i<r?e.x*r:e.y}}else o={width:e.x,height:e.y};t.css(o)},this.removeMedia=function(e,t,n){f(e),n.detach();var o=e.data("callbacks");o&&o.onMediaDelete&&o.onMediaDelete(n,this,e),h(e)},this.focus=function(e){e.focus()}},se=function(){this.update=function(n,e){var t=function(e,t){e.find(".dropdown-menu li a").each(function(){var e=T(this).data("value")+""==t+"";this.className=e?"checked":""})},o=function(e,t){n.find(e).toggleClass("active",t())};if(e.image){var i=T(e.image);o('button[data-event="imageShape"][data-value="img-rounded"]',function(){return i.hasClass("img-rounded")}),o('button[data-event="imageShape"][data-value="img-circle"]',function(){return i.hasClass("img-circle")}),o('button[data-event="imageShape"][data-value="img-thumbnail"]',function(){return i.hasClass("img-thumbnail")}),o('button[data-event="imageShape"]:not([data-value])',function(){return!i.is(".img-rounded, .img-circle, .img-thumbnail")});var r=i.css("float");o('button[data-event="floatMe"][data-value="left"]',function(){return"left"===r}),o('button[data-event="floatMe"][data-value="right"]',function(){return"right"===r}),o('button[data-event="floatMe"][data-value="none"]',function(){return"left"!==r&&"right"!==r});var a=i.attr("style");return o('button[data-event="resize"][data-value="1"]',function(){return!!/(^|\s)(max-)?width\s*:\s*100%/.test(a)}),o('button[data-event="resize"][data-value="0.5"]',function(){return!!/(^|\s)(max-)?width\s*:\s*50%/.test(a)}),void o('button[data-event="resize"][data-value="0.25"]',function(){return!!/(^|\s)(max-)?width\s*:\s*25%/.test(a)})}var s=n.find(".note-fontname");if(s.length){var l=e["font-family"];if(l){for(var d=l.split(","),c=0,u=d.length;c<u&&(l=d[c].replace(/[\'\"]/g,"").replace(/\s+$/,"").replace(/^\s+/,""),!G.isFontInstalled(l));c++);s.find(".note-current-fontname").text(l),t(s,l)}}var f=n.find(".note-fontsize");f.find(".note-current-fontsize").text(e["font-size"]),t(f,parseFloat(e["font-size"])),t(n.find(".note-height"),parseFloat(e["line-height"])),o('button[data-event="bold"]',function(){return"bold"===e["font-bold"]}),o('button[data-event="italic"]',function(){return"italic"===e["font-italic"]}),o('button[data-event="underline"]',function(){return"underline"===e["font-underline"]}),o('button[data-event="strikethrough"]',function(){return"strikethrough"===e["font-strikethrough"]}),o('button[data-event="superscript"]',function(){return"superscript"===e["font-superscript"]}),o('button[data-event="subscript"]',function(){return"subscript"===e["font-subscript"]}),o('button[data-event="justifyLeft"]',function(){return"left"===e["text-align"]||"start"===e["text-align"]}),o('button[data-event="justifyCenter"]',function(){return"center"===e["text-align"]}),o('button[data-event="justifyRight"]',function(){return"right"===e["text-align"]}),o('button[data-event="justifyFull"]',function(){return"justify"===e["text-align"]}),o('button[data-event="insertUnorderedList"]',function(){return"unordered"===e["list-style"]}),o('button[data-event="insertOrderedList"]',function(){return"ordered"===e["list-style"]})},this.updateRecentColor=function(e,t,n){var o=T(e).closest(".note-color").find(".note-recent-color"),i=JSON.parse(o.attr("data-value"));i[t]=n,o.attr("data-value",JSON.stringify(i));var r="backColor"===t?"background-color":"color";o.find("i").css(r,n)}},le=function(){var o=new se;this.update=function(e,t){o.update(e,t)},this.updateRecentColor=function(e,t,n){o.updateRecentColor(e,t,n)},this.activate=function(e){e.find("button").not('button[data-event="codeview"]').removeClass("disabled")},this.deactivate=function(e){e.find("button").not('button[data-event="codeview"]').addClass("disabled")},this.updateFullscreen=function(e,t){e.find('button[data-event="fullscreen"]').toggleClass("active",t)},this.updateCodeview=function(e,t){e.find('button[data-event="codeview"]').toggleClass("active",t),t?this.deactivate(e):this.activate(e)},this.get=function(e,t){return Z.makeLayoutInfo(e).toolbar().find("[data-name="+t+"]")},this.setButtonState=function(e,t,n){n=!1!==n,this.get(e,t).toggleClass("active",n)}},de=function(){var t=T(document);this.attach=function(e,t){t.disableResizeEditor||e.statusbar().on("mousedown",n)};var n=function(e){e.preventDefault(),e.stopPropagation();var n=Z.makeLayoutInfo(e.target).editable(),o=n.offset().top-t.scrollTop(),i=Z.makeLayoutInfo(e.currentTarget||e.target).editor().data("options");t.on("mousemove",function(e){var t=e.clientY-(o+24);t=0<i.minHeight?Math.max(t,i.minHeight):t,t=0<i.maxHeight?Math.min(t,i.maxHeight):t,n.height(t)}).one("mouseup",function(){t.off("mousemove")})}},ce=function(){var u=new se,f=function(e,t){var n=T(e),o=t?n.offset():n.position(),i=n.outerHeight(!0);return{left:o.left,top:o.top+i}},h=function(e,t){e.css({display:"block",left:t.left,top:t.top})};this.update=function(e,t,n){u.update(e,t);var o=e.find(".note-link-popover");if(t.anchor){var i=o.find("a"),r=T(t.anchor).attr("href"),a=T(t.anchor).attr("target");i.attr("href",r).html(r),a?i.attr("target","_blank"):i.removeAttr("target"),h(o,f(t.anchor,n))}else o.hide();var s=e.find(".note-image-popover");t.image?h(s,f(t.image,n)):s.hide();var l=e.find(".note-air-popover");if(n&&!t.range.isCollapsed()){var d=Y.last(t.range.getClientRects());if(d){var c=J.rect2bnd(d);h(l,{left:Math.max(c.left+c.width/2-20,0),top:c.top+c.height})}}else l.hide()},this.updateRecentColor=function(e,t,n){e.updateRecentColor(e,t,n)},this.hide=function(e){e.children().hide()}},ue=function(u){var f=T(document),t=function(e){if(Z.isControlSizing(e.target)){e.preventDefault(),e.stopPropagation();var t=Z.makeLayoutInfo(e.target),n=t.handle(),o=t.popover(),i=t.editable(),r=t.editor(),a=n.find(".note-control-selection").data("target"),s=T(a),l=s.offset(),d=f.scrollTop(),c=r.data("options").airMode;f.on("mousemove",function(e){u.invoke("editor.resizeTo",{x:e.clientX-l.left,y:e.clientY-(l.top-d)},s,!e.shiftKey),u.invoke("handle.update",n,{image:a},c),u.invoke("popover.update",o,{image:a},c)}).one("mouseup",function(){f.off("mousemove"),u.invoke("editor.afterCommand",i)}),s.data("ratio")||s.data("ratio",s.height()/s.width())}};this.attach=function(e){e.handle().on("mousedown",t)},this.update=function(e,t,n){var o=e.find(".note-control-selection");if(t.image){var i=T(t.image),r=n?i.offset():i.position(),a={w:i.outerWidth(!0),h:i.outerHeight(!0)};o.css({display:"block",left:r.left,top:r.top,width:a.w,height:a.h}).data("target",t.image);var s=a.w+"x"+a.h;o.find(".note-control-selection-info").text(s)}else o.hide()},this.hide=function(e){e.children().hide()}},fe=function(s){var l=T(window),d=T("html, body");this.toggle=function(e){var t=e.editor(),n=e.toolbar(),o=e.editable(),i=e.codable(),r=function(e){o.css("height",e.h),i.css("height",e.h),i.data("cmeditor")&&i.data("cmeditor").setsize(null,e.h)};t.toggleClass("fullscreen");var a=t.hasClass("fullscreen");a?(o.data("orgheight",o.css("height")),l.on("resize",function(){r({h:l.height()-n.outerHeight()})}).trigger("resize"),d.css("overflow","hidden")):(l.off("resize"),r({h:o.data("orgheight")}),d.css("overflow","visible")),s.invoke("toolbar.updateFullscreen",n,a)}};G.hasCodeMirror&&(G.isSupportAmd?require(["CodeMirror"],function(e){V=e}):V=window.CodeMirror);var he=function(c){this.sync=function(e){c.invoke("codeview.isActivated",e)&&G.hasCodeMirror&&e.codable().data("cmEditor").save()},this.isActivated=function(e){return e.editor().hasClass("codeview")},this.toggle=function(e){this.isActivated(e)?this.deactivate(e):this.activate(e)},this.activate=function(e){var t=e.editor(),n=e.toolbar(),o=e.editable(),i=e.codable(),r=e.popover(),a=e.handle(),s=t.data("options");if(i.val(Z.html(o,s.prettifyHtml)),i.height(o.height()),c.invoke("toolbar.updateCodeview",n,!0),c.invoke("popover.hide",r),c.invoke("handle.hide",a),t.addClass("codeview"),i.focus(),G.hasCodeMirror){var l=V.fromTextArea(i[0],s.codemirror);if(s.codemirror.tern){var d=new V.TernServer(s.codemirror.tern);l.ternServer=d,l.on("cursorActivity",function(e){d.updateArgHints(e)})}l.setSize(null,o.outerHeight()),i.data("cmEditor",l)}},this.deactivate=function(e){var t=e.editor(),n=e.toolbar(),o=e.editable(),i=e.codable(),r=t.data("options");if(G.hasCodeMirror){var a=i.data("cmEditor");i.val(a.getValue()),a.toTextArea()}o.html(Z.value(i,r.prettifyHtml)||Z.emptyPara),o.height(r.height?i.height():"auto"),t.removeClass("codeview"),o.focus(),c.invoke("toolbar.updateCodeview",n,!1)}},ve=function(d){var n=T(document);this.attach=function(e,t){t.airMode||t.disableDragAndDrop?n.on("drop",function(e){e.preventDefault()}):this.attachDragAndDropEvent(e,t)},this.attachDragAndDropEvent=function(o,i){var r=T(),a=o.editor(),s=o.dropzone(),l=s.find(".note-dropzone-message");n.on("dragenter",function(e){var t=d.invoke("codeview.isActivated",o),n=0<a.width()&&0<a.height();t||r.length||!n||(a.addClass("dragover"),s.width(a.width()),s.height(a.height()),l.text(i.langInfo.image.dragImageHere)),r=r.add(e.target)}).on("dragleave",function(e){(r=r.not(e.target)).length||a.removeClass("dragover")}).on("drop",function(){r=T(),a.removeClass("dragover")}),s.on("dragenter",function(){s.addClass("hover"),l.text(i.langInfo.image.dropImage)}).on("dragleave",function(){s.removeClass("hover"),l.text(i.langInfo.image.dragImageHere)}),s.on("drop",function(e){e.preventDefault();var t=e.originalEvent.dataTransfer,n=t.getData("text/html"),o=t.getData("text/plain"),i=Z.makeLayoutInfo(e.currentTarget||e.target);t&&t.files&&t.files.length?(i.editable().focus(),d.insertImages(i,t.files)):n?T(n).each(function(){i.editable().focus(),d.invoke("editor.insertNode",i.editable(),this)}):o&&(i.editable().focus(),d.invoke("editor.insertText",i.editable(),o))}).on("dragover",!1)}},pe=function(d){this.attach=function(e){e.editable().on("paste",t)};var t=function(e){var t=e.originalEvent.clipboardData,s=Z.makeLayoutInfo(e.currentTarget||e.target),l=s.editable();if(!t||!t.items||!t.items.length){if(!l.data("callbacks").onImageUpload)return;return d.invoke("editor.saveNode",l),d.invoke("editor.saveRange",l),l.html(""),void setTimeout(function(){var e=l.find("img");if(e.length&&-1!==e[0].src.indexOf("data:")){for(var t=e[0].src,n=atob(t.split(",")[1]),o=new Uint8Array(n.length),i=0;i<n.length;i++)o[i]=n.charCodeAt(i);var r=new Blob([o],{type:"image/png"});r.name="clipboard.png",d.invoke("editor.restoreNode",l),d.invoke("editor.restoreRange",l),d.insertImages(s,[r]),d.invoke("editor.afterCommand",l)}else{var a=l.html();d.invoke("editor.restoreNode",l),d.invoke("editor.restoreRange",l);try{T(a).each(function(){l.focus(),d.invoke("editor.insertNode",l,this)})}catch(e){l.focus(),d.invoke("editor.insertText",l,a)}}},0)}var n=Y.head(t.items);"file"===n.kind&&-1!==n.type.indexOf("image/")&&d.insertImages(s,[n.getAsFile()]),d.invoke("editor.afterCommand",l)}},ge=function(s){var l=function(e,t){e.toggleClass("disabled",!t),e.attr("disabled",!t)};this.showLinkDialog=function(e,a,s){return T.Deferred(function(t){var n=a.find(".note-link-dialog"),o=n.find(".note-link-text"),i=n.find(".note-link-url"),e=n.find(".note-link-btn"),r=n.find("input[type=checkbox]");n.one("shown.bs.modal",function(){o.val(s.text),o.on("input",function(){s.text=o.val()}),s.url||(s.url=s.text,l(e,s.text)),i.on("input",function(){l(e,i.val()),s.text||o.val(i.val())}).val(s.url).trigger("focus").trigger("select"),r.prop("checked",s.newWindow),e.one("click",function(e){e.preventDefault(),t.resolve({range:s.range,url:i.val(),text:o.val(),newWindow:r.is(":checked")}),n.modal("hide")})}).one("hidden.bs.modal",function(){o.off("input"),i.off("input"),e.off("click"),"pending"===t.state()&&t.reject()}).modal("show")}).promise()},this.show=function(e){var t=e.editor(),n=e.dialog(),o=e.editable(),i=e.popover(),r=s.invoke("editor.getLinkInfo",o),a=t.data("options");s.invoke("editor.saveRange",o),this.showLinkDialog(o,n,r).then(function(e){s.invoke("editor.restoreRange",o),s.invoke("editor.createLink",o,e,a),s.invoke("popover.hide",i)}).fail(function(){s.invoke("editor.restoreRange",o)})}},me=function(o){this.show=function(t){var e=t.dialog(),n=t.editable();o.invoke("editor.saveRange",n),this.showImageDialog(n,e).then(function(e){o.invoke("editor.restoreRange",n),"string"==typeof e?o.invoke("editor.insertImage",n,e):o.insertImages(t,e)}).fail(function(){o.invoke("editor.restoreRange",n)})},this.showImageDialog=function(e,o){return T.Deferred(function(t){var n=o.find(".note-image-dialog"),e=o.find(".note-image-input"),i=o.find(".note-image-url"),r=o.find(".note-image-btn");n.one("shown.bs.modal",function(){e.replaceWith(e.clone().on("change",function(){t.resolve(this.files||this.value),n.modal("hide")}).val("")),r.click(function(e){e.preventDefault(),t.resolve(i.val()),n.modal("hide")}),i.on("keyup paste",function(e){var t,n,o;t="paste"===e.type?e.originalEvent.clipboardData.getData("text"):i.val(),o=t,(n=r).toggleClass("disabled",!o),n.attr("disabled",!o)}).val("").trigger("focus")}).one("hidden.bs.modal",function(){e.off("change"),i.off("keyup paste"),r.off("click"),"pending"===t.state()&&t.reject()}).modal("show")})}},be=function(o){this.showHelpDialog=function(e,t){return T.Deferred(function(e){t.find(".note-help-dialog").one("hidden.bs.modal",function(){e.resolve()}).modal("show")}).promise()},this.show=function(e){var t=e.dialog(),n=e.editable();o.invoke("editor.saveRange",n,!0),this.showHelpDialog(n,t).then(function(){o.invoke("editor.restoreRange",n)})}};T.summernote=T.summernote||{},T.extend(T.summernote,{version:"0.6.3",options:{width:null,height:null,minHeight:null,maxHeight:null,focus:!1,tabsize:4,styleWithSpan:!0,disableLinkTarget:!1,disableDragAndDrop:!1,disableResizeEditor:!1,shortcuts:!0,placeholder:!1,prettifyHtml:!0,iconPrefix:"fa fa-",codemirror:{mode:"text/html",htmlMode:!0,lineNumbers:!0},lang:"en-US",direction:null,toolbar:[["style",["style"]],["font",["bold","italic","underline","clear"]],["fontname",["fontname"]],["color",["color"]],["para",["ul","ol","paragraph"]],["height",["height"]],["table",["table"]],["insert",["link","picture","hr"]],["view",["fullscreen","codeview"]],["help",["help"]]],airMode:!1,airPopover:[["color",["color"]],["font",["bold","underline","clear"]],["para",["ul","paragraph"]],["table",["table"]],["insert",["link","picture"]]],styleTags:["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],defaultFontName:"Helvetica Neue",fontNames:["Arial","Arial Black","Comic Sans MS","Courier New","Helvetica Neue","Helvetica","Impact","Lucida Grande","Tahoma","Times New Roman","Verdana"],fontNamesIgnoreCheck:[],colors:[["#000000","#424242","#636363","#9C9C94","#CEC6CE","#EFEFEF","#F7F7F7","#FFFFFF"],["#FF0000","#FF9C00","#FFFF00","#00FF00","#00FFFF","#0000FF","#9C00FF","#FF00FF"],["#F7C6CE","#FFE7CE","#FFEFC6","#D6EFD6","#CEDEE7","#CEE7F7","#D6D6E7","#E7D6DE"],["#E79C9C","#FFC69C","#FFE79C","#B5D6A5","#A5C6CE","#9CC6EF","#B5A5D6","#D6A5BD"],["#E76363","#F7AD6B","#FFD663","#94BD7B","#73A5AD","#6BADDE","#8C7BC6","#C67BA5"],["#CE0000","#E79439","#EFC631","#6BA54A","#4A7B8C","#3984C6","#634AA5","#A54A7B"],["#9C0000","#B56308","#BD9400","#397B21","#104A5A","#085294","#311873","#731842"],["#630000","#7B3900","#846300","#295218","#083139","#003163","#21104A","#4A1031"]],lineHeights:["1.0","1.2","1.4","1.5","1.6","1.8","2.0","3.0"],insertTableMaxSize:{col:10,row:10},maximumImageFileSize:null,oninit:null,onfocus:null,onblur:null,onenter:null,onkeyup:null,onkeydown:null,onImageUpload:null,onImageUploadError:null,onMediaDelete:null,onToolbarClick:null,onsubmit:null,onCreateLink:function(e){return-1!==e.indexOf("@")&&-1===e.indexOf(":")?e="mailto:"+e:-1===e.indexOf("://")&&(e="http://"+e),e},keyMap:{pc:{ENTER:"insertParagraph","CTRL+Z":"undo","CTRL+Y":"redo",TAB:"tab","SHIFT+TAB":"untab","CTRL+B":"bold","CTRL+I":"italic","CTRL+U":"underline","CTRL+SHIFT+S":"strikethrough","CTRL+BACKSLASH":"removeFormat","CTRL+SHIFT+L":"justifyLeft","CTRL+SHIFT+E":"justifyCenter","CTRL+SHIFT+R":"justifyRight","CTRL+SHIFT+J":"justifyFull","CTRL+SHIFT+NUM7":"insertUnorderedList","CTRL+SHIFT+NUM8":"insertOrderedList","CTRL+LEFTBRACKET":"outdent","CTRL+RIGHTBRACKET":"indent","CTRL+NUM0":"formatPara","CTRL+NUM1":"formatH1","CTRL+NUM2":"formatH2","CTRL+NUM3":"formatH3","CTRL+NUM4":"formatH4","CTRL+NUM5":"formatH5","CTRL+NUM6":"formatH6","CTRL+ENTER":"insertHorizontalRule","CTRL+K":"showLinkDialog"},mac:{ENTER:"insertParagraph","CMD+Z":"undo","CMD+SHIFT+Z":"redo",TAB:"tab","SHIFT+TAB":"untab","CMD+B":"bold","CMD+I":"italic","CMD+U":"underline","CMD+SHIFT+S":"strikethrough","CMD+BACKSLASH":"removeFormat","CMD+SHIFT+L":"justifyLeft","CMD+SHIFT+E":"justifyCenter","CMD+SHIFT+R":"justifyRight","CMD+SHIFT+J":"justifyFull","CMD+SHIFT+NUM7":"insertUnorderedList","CMD+SHIFT+NUM8":"insertOrderedList","CMD+LEFTBRACKET":"outdent","CMD+RIGHTBRACKET":"indent","CMD+NUM0":"formatPara","CMD+NUM1":"formatH1","CMD+NUM2":"formatH2","CMD+NUM3":"formatH3","CMD+NUM4":"formatH4","CMD+NUM5":"formatH5","CMD+NUM6":"formatH6","CMD+ENTER":"insertHorizontalRule","CMD+K":"showLinkDialog"}}},lang:{"en-US":{font:{bold:"Bold",italic:"Italic",underline:"Underline",clear:"Remove Font Style",height:"Line Height",name:"Font Family"},image:{image:"Picture",insert:"Insert Image",resizeFull:"Resize Full",resizeHalf:"Resize Half",resizeQuarter:"Resize Quarter",floatLeft:"Float Left",floatRight:"Float Right",floatNone:"Float None",shapeRounded:"Shape: Rounded",shapeCircle:"Shape: Circle",shapeThumbnail:"Shape: Thumbnail",shapeNone:"Shape: None",dragImageHere:"Drag image or text here",dropImage:"Drop image or Text",selectFromFiles:"Select from files",maximumFileSize:"Maximum file size",maximumFileSizeError:"Maximum file size exceeded.",url:"Image URL",remove:"Remove Image"},link:{link:"Link",insert:"Insert Link",unlink:"Unlink",edit:"Edit",textToDisplay:"Text to display",url:"To what URL should this link go?",openInNewWindow:"Open in new window"},table:{table:"Table"},hr:{insert:"Insert Horizontal Rule"},style:{style:"Style",normal:"Normal",blockquote:"Quote",pre:"Code",h1:"Header 1",h2:"Header 2",h3:"Header 3",h4:"Header 4",h5:"Header 5",h6:"Header 6"},lists:{unordered:"Unordered list",ordered:"Ordered list"},options:{help:"Help",fullscreen:"Full Screen",codeview:"Code View"},paragraph:{paragraph:"Paragraph",outdent:"Outdent",indent:"Indent",left:"Align left",center:"Align center",right:"Align right",justify:"Justify full"},color:{recent:"Recent Color",more:"More Color",background:"Background Color",foreground:"Foreground Color",transparent:"Transparent",setTransparent:"Set transparent",reset:"Reset",resetToDefault:"Reset to default"},shortcut:{shortcuts:"Keyboard shortcuts",close:"Close",textFormatting:"Text formatting",action:"Action",paragraphFormatting:"Paragraph formatting",documentStyle:"Document Style",extraKeys:"Extra keys"},history:{undo:"Undo",redo:"Redo"}}}});var Ce=new function(){var g=function(e,t){var n=t.event,o=t.value,i=t.title,r=t.className,a=t.dropdown,s=t.hide;return'<button type="button" class="btn btn-default btn-sm btn-small'+(r?" "+r:"")+(a?" dropdown-toggle":"")+'"'+(a?' data-toggle="dropdown"':"")+(i?' title="'+i+'"':"")+(n?' data-event="'+n+'"':"")+(o?" data-value='"+o+"'":"")+(s?" data-hide='"+s+"'":"")+' tabindex="-1">'+e+(a?' <span class="caret"></span>':"")+"</button>"+(a||"")},m=function(e,t){return g('<i class="'+e+'"></i>',t)},b=function(e,t){var n=T('<div class="'+e+' popover bottom in" style="display: none;"><div class="arrow"></div><div class="popover-content"></div></div>');return n.find(".popover-content").append(t),n},s=function(e,t,n,o){return'<div class="'+e+' modal" aria-hidden="false"><div class="modal-dialog"><div class="modal-content">'+(t?'<div class="modal-header"><button type="button" class="close" aria-hidden="true" tabindex="-1">&times;</button><h4 class="modal-title">'+t+"</h4></div>":"")+'<form class="note-modal-form"><div class="modal-body">'+n+"</div>"+(o?'<div class="modal-footer">'+o+"</div>":"")+"</form></div></div></div>"},C={picture:function(e,t){return m(t.iconPrefix+"picture-o",{event:"showImageDialog",title:e.image.image,hide:!0})},link:function(e,t){return m(t.iconPrefix+"link",{event:"showLinkDialog",title:e.link.link,hide:!0})},table:function(e,t){return m(t.iconPrefix+"table",{title:e.table.table,dropdown:'<ul class="note-table dropdown-menu"><div class="note-dimension-picker"><div class="note-dimension-picker-mousecatcher" data-event="insertTable" data-value="1x1"></div><div class="note-dimension-picker-highlighted"></div><div class="note-dimension-picker-unhighlighted"></div></div><div class="note-dimension-display"> 1 x 1 </div></ul>'})},style:function(o,e){var t=e.styleTags.reduce(function(e,t){var n=o.style["p"===t?"normal":t];return e+'<li><a data-event="formatBlock" href="#" data-value="'+t+'">'+("p"===t||"pre"===t?n:"<"+t+">"+n+"</"+t+">")+"</a></li>"},"");return m(e.iconPrefix+"magic",{title:o.style.style,dropdown:'<ul class="dropdown-menu">'+t+"</ul>"})},fontname:function(e,n){var o=[],t=n.fontNames.reduce(function(e,t){return G.isFontInstalled(t)||-1!==n.fontNamesIgnoreCheck.indexOf(t)?(o.push(t),e+'<li><a data-event="fontName" href="#" data-value="'+t+'" style="font-family:\''+t+'\'"><i class="'+n.iconPrefix+'check"></i> '+t+"</a></li>"):e},""),i=G.isFontInstalled(n.defaultFontName)?n.defaultFontName:o[0];return g('<span class="note-current-fontname">'+i+"</span>",{title:e.font.name,dropdown:'<ul class="dropdown-menu">'+t+"</ul>"})},color:function(e,t){var n='<i class="'+t.iconPrefix+'font" style="color:black;background-color:yellow;"></i>',o=g(n,{className:"note-recent-color",title:e.color.recent,event:"color",value:'{"backColor":"yellow"}'}),i='<ul class="dropdown-menu"><li><div class="btn-group"><div class="note-palette-title">'+e.color.background+'</div><div class="note-color-reset" data-event="backColor" data-value="inherit" title="'+e.color.transparent+'">'+e.color.setTransparent+'</div><div class="note-color-palette" data-target-event="backColor"></div></div><div class="btn-group"><div class="note-palette-title">'+e.color.foreground+'</div><div class="note-color-reset" data-event="foreColor" data-value="inherit" title="'+e.color.reset+'">'+e.color.resetToDefault+'</div><div class="note-color-palette" data-target-event="foreColor"></div></div></li></ul>';return o+g("",{title:e.color.more,dropdown:i})},bold:function(e,t){return m(t.iconPrefix+"bold",{event:"bold",title:e.font.bold})},italic:function(e,t){return m(t.iconPrefix+"italic",{event:"italic",title:e.font.italic})},underline:function(e,t){return m(t.iconPrefix+"underline",{event:"underline",title:e.font.underline})},clear:function(e,t){return m(t.iconPrefix+"eraser",{event:"removeFormat",title:e.font.clear})},ul:function(e,t){return m(t.iconPrefix+"list-ul",{event:"insertUnorderedList",title:e.lists.unordered})},ol:function(e,t){return m(t.iconPrefix+"list-ol",{event:"insertOrderedList",title:e.lists.ordered})},paragraph:function(e,t){var n=m(t.iconPrefix+"align-left",{title:e.paragraph.left,event:"justifyLeft"}),o=m(t.iconPrefix+"align-center",{title:e.paragraph.center,event:"justifyCenter"}),i=m(t.iconPrefix+"align-right",{title:e.paragraph.right,event:"justifyRight"}),r=m(t.iconPrefix+"align-justify",{title:e.paragraph.justify,event:"justifyFull"}),a=m(t.iconPrefix+"outdent",{title:e.paragraph.outdent,event:"outdent"}),s='<div class="dropdown-menu"><div class="note-align btn-group">'+n+o+i+r+'</div><div class="note-list btn-group">'+m(t.iconPrefix+"indent",{title:e.paragraph.indent,event:"indent"})+a+"</div></div>";return m(t.iconPrefix+"align-left",{title:e.paragraph.paragraph,dropdown:s})},height:function(e,n){var t=n.lineHeights.reduce(function(e,t){return e+'<li><a data-event="lineHeight" href="#" data-value="'+parseFloat(t)+'"><i class="'+n.iconPrefix+'check"></i> '+t+"</a></li>"},"");return m(n.iconPrefix+"text-height",{title:e.font.height,dropdown:'<ul class="dropdown-menu">'+t+"</ul>"})},help:function(e,t){return m(t.iconPrefix+"question",{event:"showHelpDialog",title:e.options.help,hide:!0})},fullscreen:function(e,t){return m(t.iconPrefix+"arrows-alt",{event:"fullscreen",title:e.options.fullscreen})},codeview:function(e,t){return m(t.iconPrefix+"code",{event:"codeview",title:e.options.codeview})},undo:function(e,t){return m(t.iconPrefix+"undo",{event:"undo",title:e.history.undo})},redo:function(e,t){return m(t.iconPrefix+"repeat",{event:"redo",title:e.history.redo})},hr:function(e,t){return m(t.iconPrefix+"minus",{event:"insertHorizontalRule",title:e.hr.insert})}},y=function(l,d){var e,t,n,o,i,r,a,s,c,u,f,h,v,p=T('<div class="note-popover" />');return p.append((e=m(d.iconPrefix+"edit",{title:l.link.edit,event:"showLinkDialog",hide:!0}),t=m(d.iconPrefix+"unlink",{title:l.link.unlink,event:"unlink"}),b("note-link-popover",'<a href="http://www.google.com" target="_blank">www.google.com</a>&nbsp;&nbsp;<div class="note-insert btn-group">'+e+t+"</div>"))),p.append((n=g('<span class="note-fontsize-10">100%</span>',{title:l.image.resizeFull,event:"resize",value:"1"}),o=g('<span class="note-fontsize-10">50%</span>',{title:l.image.resizeHalf,event:"resize",value:"0.5"}),i=g('<span class="note-fontsize-10">25%</span>',{title:l.image.resizeQuarter,event:"resize",value:"0.25"}),r=m(d.iconPrefix+"align-left",{title:l.image.floatLeft,event:"floatMe",value:"left"}),a=m(d.iconPrefix+"align-right",{title:l.image.floatRight,event:"floatMe",value:"right"}),s=m(d.iconPrefix+"align-justify",{title:l.image.floatNone,event:"floatMe",value:"none"}),c=m(d.iconPrefix+"square",{title:l.image.shapeRounded,event:"imageShape",value:"img-rounded"}),u=m(d.iconPrefix+"circle-o",{title:l.image.shapeCircle,event:"imageShape",value:"img-circle"}),f=m(d.iconPrefix+"picture-o",{title:l.image.shapeThumbnail,event:"imageShape",value:"img-thumbnail"}),h=m(d.iconPrefix+"times",{title:l.image.shapeNone,event:"imageShape",value:""}),v=m(d.iconPrefix+"trash-o",{title:l.image.remove,event:"removeMedia",value:"none"}),b("note-image-popover",'<div class="btn-group">'+n+o+i+'</div><div class="btn-group">'+r+a+s+'</div><div class="btn-group">'+c+u+f+h+'</div><div class="btn-group">'+v+"</div>"))),d.airMode&&p.append(function(){for(var e=T("<div />"),t=0,n=d.airPopover.length;t<n;t++){for(var o=d.airPopover[t],i=T('<div class="note-'+o[0]+' btn-group">'),r=0,a=o[1].length;r<a;r++){var s=T(C[o[1][r]](l,d));s.attr("data-name",o[1][r]),i.append(s)}e.append(i)}return b("note-air-popover",e.children())}()),p},f=function(e,t){var n="note-shortcut-col col-xs-6 note-shortcut-",o=[];for(var i in t)t.hasOwnProperty(i)&&o.push('<div class="'+n+'key">'+t[i].kbd+'</div><div class="'+n+'name">'+t[i].text+"</div>");return'<div class="note-shortcut-row row"><div class="'+n+'title col-xs-offset-6">'+e+'</div></div><div class="note-shortcut-row row">'+o.join('</div><div class="note-shortcut-row row">')+"</div>"},o=function(e,t){var n,o,i,r,a,s,l,d,c='class="note-shortcut note-shortcut-col col-sm-6 col-xs-12"',u=["<div "+c+">"+(l=e,d=[{kbd:"⌘ + Z",text:l.history.undo},{kbd:"⌘ + ⇧ + Z",text:l.history.redo},{kbd:"⌘ + ]",text:l.paragraph.indent},{kbd:"⌘ + [",text:l.paragraph.outdent},{kbd:"⌘ + ENTER",text:l.hr.insert}],f(l.shortcut.action,d))+"</div><div "+c+">"+(a=e,s=[{kbd:"⌘ + B",text:a.font.bold},{kbd:"⌘ + I",text:a.font.italic},{kbd:"⌘ + U",text:a.font.underline},{kbd:"⌘ + \\",text:a.font.clear}],f(a.shortcut.textFormatting,s))+"</div>","<div "+c+">"+(i=e,r=[{kbd:"⌘ + NUM0",text:i.style.normal},{kbd:"⌘ + NUM1",text:i.style.h1},{kbd:"⌘ + NUM2",text:i.style.h2},{kbd:"⌘ + NUM3",text:i.style.h3},{kbd:"⌘ + NUM4",text:i.style.h4},{kbd:"⌘ + NUM5",text:i.style.h5},{kbd:"⌘ + NUM6",text:i.style.h6}],f(i.shortcut.documentStyle,r))+"</div><div "+c+">"+(n=e,o=[{kbd:"⌘ + ⇧ + L",text:n.paragraph.left},{kbd:"⌘ + ⇧ + E",text:n.paragraph.center},{kbd:"⌘ + ⇧ + R",text:n.paragraph.right},{kbd:"⌘ + ⇧ + J",text:n.paragraph.justify},{kbd:"⌘ + ⇧ + NUM7",text:n.lists.ordered},{kbd:"⌘ + ⇧ + NUM8",text:n.lists.unordered}],f(n.shortcut.paragraphFormatting,o))+"</div>"];return t.extraKeys&&u.push("<div "+c+">"+function(e,t){var n=t.extraKeys,o=[];for(var i in n)n.hasOwnProperty(i)&&o.push({kbd:i,text:n[i]});return f(e.shortcut.extraKeys,o)}(e,t)+"</div>"),'<div class="note-shortcut-row row">'+u.join('</div><div class="note-shortcut-row row">')+"</div>"},r={image:function(e,t){var n="";if(t.maximumImageFileSize){var o=Math.floor(Math.log(t.maximumImageFileSize)/Math.log(1024)),i=1*(t.maximumImageFileSize/Math.pow(1024,o)).toFixed(2)+" "+" KMGTP"[o]+"B";n="<small>"+e.image.maximumFileSize+" : "+i+"</small>"}var r='<div class="form-group row-fluid note-group-select-from-files"><label>'+e.image.selectFromFiles+'</label><input class="note-image-input" type="file" name="files" accept="image/*" multiple="multiple" />'+n+'</div><div class="form-group row-fluid"><label>'+e.image.url+'</label><input class="note-image-url form-control span12" type="text" /></div>',a='<button href="#" class="btn btn-primary note-image-btn disabled" disabled>'+e.image.insert+"</button>";return s("note-image-dialog",e.image.insert,r,a)},link:function(e,t){var n='<div class="form-group row-fluid"><label>'+e.link.textToDisplay+'</label><input class="note-link-text form-control span12" type="text" /></div><div class="form-group row-fluid"><label>'+e.link.url+'</label><input class="note-link-url form-control span12" type="text" /></div>'+(t.disableLinkTarget?"":'<div class="checkbox"><label><input type="checkbox" checked> '+e.link.openInNewWindow+"</label></div>"),o='<button href="#" class="btn btn-primary note-link-btn disabled" disabled>'+e.link.insert+"</button>";return s("note-link-dialog",e.link.insert,n,o)},help:function(e,t){var n='<a class="modal-close pull-right" aria-hidden="true" tabindex="-1">'+e.shortcut.close+'</a><div class="title">'+e.shortcut.shortcuts+"</div>"+(G.isMac?o(e,t):o(e,t).replace(/⌘/g,"Ctrl").replace(/⇧/g,"Shift"))+'<p class="text-center"><a href="//summernote.org/" target="_blank">Summernote 0.6.3</a> · <a href="//github.com/summernote/summernote" target="_blank">Project</a> · <a href="//github.com/summernote/summernote/issues" target="_blank">Issues</a></p>';return s("note-help-dialog","",n,"")}},k=function(n,o){var i="";return T.each(r,function(e,t){i+=t(n,o)}),'<div class="note-dialog">'+i+"</div>"},x=function(e,t,n){var i=J.invertObject(t);e.find("button").each(function(e,t){var n=T(t),o=i[n.data("event")];o&&n.attr("title",function(e,t){return t+" ("+(n=o,G.isMac&&(n=n.replace("CMD","⌘").replace("SHIFT","⇧")),n.replace("BACKSLASH","\\").replace("SLASH","/").replace("LEFTBRACKET","[").replace("RIGHTBRACKET","]"))+")";var n})}).tooltip({container:"body",trigger:"hover",placement:n||"top"}).on("click",function(){T(this).tooltip("hide")})},w=function(e,t){var c=t.colors;e.find(".note-color-palette").each(function(){for(var e=T(this),t=e.attr("data-target-event"),n=[],o=0,i=c.length;o<i;o++){for(var r=c[o],a=[],s=0,l=r.length;s<l;s++){var d=r[s];a.push(['<button type="button" class="note-color-btn" style="background-color:',d,';" data-event="',t,'" data-value="',d,'" title="',d,'" data-toggle="button" tabindex="-1"></button>'].join(""))}n.push('<div class="note-color-row">'+a.join("")+"</div>")}e.html(n.join(""))})};this.createLayoutByAirMode=function(e,t){var n=t.langInfo,o=t.keyMap[G.isMac?"mac":"pc"],i=J.uniqueId();e.addClass("note-air-editor note-editable"),e.attr({id:"note-editor-"+i,contentEditable:!0});var r=document.body,a=T(y(n,t));a.addClass("note-air-layout"),a.attr("id","note-popover-"+i),a.appendTo(r),x(a,o),w(a,t);var s=T('<div class="note-handle"><div class="note-control-selection"><div class="note-control-selection-bg"></div><div class="note-control-holder note-control-nw"></div><div class="note-control-holder note-control-ne"></div><div class="note-control-holder note-control-sw"></div><div class="note-control-sizing note-control-se"></div><div class="note-control-selection-info"></div></div></div>');s.addClass("note-air-layout"),s.attr("id","note-handle-"+i),s.appendTo(r);var l=T(k(n,t));l.addClass("note-air-layout"),l.attr("id","note-dialog-"+i),l.find("button.close, a.modal-close").click(function(){T(this).closest(".modal").modal("hide")}),l.appendTo(r)},this.createLayoutByFrame=function(e,t){var n=t.langInfo,o=T('<div class="note-editor"></div>');t.width&&o.width(t.width),0<t.height&&T('<div class="note-statusbar">'+(t.disableResizeEditor?"":'<div class="note-resizebar"><div class="note-icon-bar"></div><div class="note-icon-bar"></div><div class="note-icon-bar"></div></div>')+"</div>").prependTo(o);var i=!e.is(":disabled"),r=T('<div class="note-editable" contentEditable="'+i+'"></div>').prependTo(o);t.height&&r.height(t.height),t.direction&&r.attr("dir",t.direction);var a=e.attr("placeholder")||t.placeholder;a&&r.attr("data-placeholder",a),r.html(Z.html(e)),T('<textarea class="note-codable"></textarea>').prependTo(o);for(var s=T('<div class="note-toolbar btn-toolbar" />'),l=0,d=t.toolbar.length;l<d;l++){for(var c=t.toolbar[l][0],u=t.toolbar[l][1],f=T('<div class="note-'+c+' btn-group" />'),h=0,v=u.length;h<v;h++){var p=C[u[h]];if(T.isFunction(p)){var g=T(p(n,t));g.attr("data-name",u[h]),f.append(g)}}s.append(f)}s.prependTo(o);var m=t.keyMap[G.isMac?"mac":"pc"];w(s,t),x(s,m,"bottom");var b=T(y(n,t)).prependTo(o);w(b,t),x(b,m),T('<div class="note-handle"><div class="note-control-selection"><div class="note-control-selection-bg"></div><div class="note-control-holder note-control-nw"></div><div class="note-control-holder note-control-ne"></div><div class="note-control-holder note-control-sw"></div><div class="note-control-sizing note-control-se"></div><div class="note-control-selection-info"></div></div></div>').prependTo(o),T(k(n,t)).prependTo(o).find("button.close, a.modal-close").click(function(){T(this).closest(".modal").modal("hide")}),T('<div class="note-dropzone"><div class="note-dropzone-message"></div></div>').prependTo(o),o.insertAfter(e),e.hide()},this.hasNoteEditor=function(e){return 0<this.noteEditorFromHolder(e).length},this.noteEditorFromHolder=function(e){return e.hasClass("note-air-editor")?e:e.next().hasClass("note-editor")?e.next():T()},this.createLayout=function(e,t){t.airMode?this.createLayoutByAirMode(e,t):this.createLayoutByFrame(e,t)},this.layoutInfoFromHolder=function(e){var t=this.noteEditorFromHolder(e);if(t.length)return t.data("holder",e),Z.buildLayoutInfo(t)},this.removeLayout=function(e,t,n){n.airMode?(e.removeClass("note-air-editor note-editable").removeAttr("id contentEditable"),t.popover().remove(),t.handle().remove(),t.dialog().remove()):(e.html(t.editable().html()),t.editor().remove(),e.show())},this.getTemplate=function(){return{button:g,iconButton:m,dialog:s}},this.addButtonInfo=function(e,t){C[e]=t},this.addDialogInfo=function(e,t){r[e]=t}},ye=new function(){var c=this.modules={editor:new ae(this),toolbar:new le(this),statusbar:new de(this),popover:new ce(this),handle:new ue(this),fullscreen:new fe(this),codeview:new he(this),dragAndDrop:new ve(this),clipboard:new pe(this),linkDialog:new ge(this),imageDialog:new me(this),helpDialog:new be(this)};this.invoke=function(){var e=Y.head(Y.from(arguments)),t=Y.tail(Y.from(arguments)),n=e.split("."),o=1<n.length,i=o&&Y.head(n),r=o?Y.last(n):Y.head(n),a=this.getModule(i),s=a[r];return s&&s.apply(a,t)},this.getModule=function(e){return this.modules[e]||this.modules.editor},this.insertImages=function(e,t){var n=e.editor(),o=e.editable(),i=e.holder(),r=o.data("callbacks"),a=n.data("options");r.onImageUpload?(r.onImageUpload(t,c.editor,o),l(i,"image.upload")([t])):T.each(t,function(e,t){var n=t.name;a.maximumImageFileSize&&a.maximumImageFileSize<t.size?r.onImageUploadError?(r.onImageUploadError(a.langInfo.image.maximumFileSizeError),l(i,"image.upload.error")(a.langInfo.image.maximumFileSizeError)):alert(a.langInfo.image.maximumFileSizeError):$.readFileAsDataURL(t).then(function(e){c.editor.insertImage(o,e,n)}).fail(function(){r.onImageUploadError&&(r.onImageUploadError(),l(i,"image.upload.error")(a.langInfo.image.maximumFileSizeError))})})};var u={showLinkDialog:function(e){c.linkDialog.show(e)},showImageDialog:function(e){c.imageDialog.show(e)},showHelpDialog:function(e){c.helpDialog.show(e)},fullscreen:function(e){c.fullscreen.toggle(e)},codeview:function(e){c.codeview.toggle(e)}},i=function(e){Z.isImg(e.target)&&e.preventDefault()},f=function(o){setTimeout(function(){var e=Z.makeLayoutInfo(o.currentTarget||o.target),t=c.editor.currentStyle(o.target);if(t){var n=e.editor().data("options").airMode;n||c.toolbar.update(e.toolbar(),t),c.popover.update(e.popover(),t,n),c.handle.update(e.handle(),t,n)}},0)},r=function(e){var t=Z.makeLayoutInfo(e.currentTarget||e.target);c.popover.hide(t.popover()),c.handle.hide(t.handle())},a=function(e){T(e.target).closest("[data-event]").length&&e.preventDefault()},s=function(e){var t=T(e.target).closest("[data-event]");if(t.length){var n,o=t.attr("data-event"),i=t.attr("data-value"),r=t.attr("data-hide"),a=Z.makeLayoutInfo(e.target);if(-1!==T.inArray(o,["resize","floatMe","removeMedia","imageShape"])){var s=a.handle().find(".note-control-selection");n=T(s.data("target"))}if(r&&t.parents(".popover").hide(),T.isFunction(T.summernote.pluginEvents[o]))T.summernote.pluginEvents[o](e,c.editor,a,i);else if(c.editor[o]){var l=a.editable();l.focus(),c.editor[o](l,i,n),e.preventDefault()}else u[o]&&(u[o].call(this,a),e.preventDefault());if(-1!==T.inArray(o,["backColor","foreColor"])){var d=a.editor().data("options",d);(d.airMode?c.popover:c.toolbar).updateRecentColor(Y.head(t),o,i)}f(e)}},l=function(e,t){return function(){return e.trigger("summernote."+t,arguments)}};this.bindKeyMap=function(r,a){var s=r.editor(),l=r.editable();l.on("keydown",function(e){var t=[];e.metaKey&&t.push("CMD"),e.ctrlKey&&!e.altKey&&t.push("CTRL"),e.shiftKey&&t.push("SHIFT");var n=ee.nameFromCode[e.keyCode];n&&t.push(n);var o=a[t.join("+")];if(o)if(T.summernote.pluginEvents[o]){var i=T.summernote.pluginEvents[o];T.isFunction(i)&&i(e,c.editor,r)}else c.editor[o]?(c.editor[o](l,s.data("options")),e.preventDefault()):u[o]&&(u[o].call(this,r),e.preventDefault());else ee.isEdit(e.keyCode)&&c.editor.afterCommand(l)})},this.attach=function(t,n){n.shortcuts&&this.bindKeyMap(t,n.keyMap[G.isMac?"mac":"pc"]),t.editable().on("mousedown",i),t.editable().on("keyup mouseup",f),t.editable().on("scroll",r),c.clipboard.attach(t,n),c.handle.attach(t,n),t.popover().on("click",s),t.popover().on("mousedown",a),c.dragAndDrop.attach(t,n),n.airMode||(t.toolbar().on("click",s),t.toolbar().on("mousedown",a),c.statusbar.attach(t,n)),(n.airMode?t.popover():t.toolbar()).find(".note-dimension-picker-mousecatcher").css({width:n.insertTableMaxSize.col+"em",height:n.insertTableMaxSize.row+"em"}).on("mousemove",function(e){!function(e,t){var n,o=T(e.target.parentNode),i=o.next(),r=o.find(".note-dimension-picker-mousecatcher"),a=o.find(".note-dimension-picker-highlighted"),s=o.find(".note-dimension-picker-unhighlighted");if(void 0===e.offsetX){var l=T(e.target).offset();n={x:e.pageX-l.left,y:e.pageY-l.top}}else n={x:e.offsetX,y:e.offsetY};var d=Math.ceil(n.x/18)||1,c=Math.ceil(n.y/18)||1;a.css({width:d+"em",height:c+"em"}),r.attr("data-value",d+"x"+c),3<d&&d<t.insertTableMaxSize.col&&s.css({width:d+1+"em"}),3<c&&c<t.insertTableMaxSize.row&&s.css({height:c+1+"em"}),i.html(d+" x "+c)}(e,n)}),t.editor().data("options",n),G.isMSIE||setTimeout(function(){document.execCommand("styleWithCSS",0,n.styleWithSpan)},0);var e=new te(t.editable());if(t.editable().data("NoteHistory",e),n.onenter&&t.editable().keypress(function(e){e.keyCode===ee.ENTER&&n.onenter(e)}),n.onfocus&&t.editable().focus(n.onfocus),n.onblur&&t.editable().blur(n.onblur),n.onkeyup&&t.editable().keyup(n.onkeyup),n.onkeydown&&t.editable().keydown(n.onkeydown),n.onpaste&&t.editable().on("paste",n.onpaste),n.onToolbarClick&&t.toolbar().click(n.onToolbarClick),n.onChange){var o=function(){c.editor.triggerOnChange(t.editable())};G.isMSIE?t.editable().on("DOMCharacterDataModified DOMSubtreeModified DOMNodeInserted",o):t.editable().on("input",o)}t.editable().data("callbacks",{onBeforeChange:n.onBeforeChange,onChange:n.onChange,onAutoSave:n.onAutoSave,onImageUpload:n.onImageUpload,onImageUploadError:n.onImageUploadError,onFileUpload:n.onFileUpload,onFileUploadError:n.onFileUpload,onMediaDelete:n.onMediaDelete}),Z.isTextarea(Y.head(t.holder()))&&t.holder().closest("form").submit(function(){var e=t.holder().code();t.holder().val(e),n.onsubmit&&n.onsubmit(e)})},this.attachCustomEvent=function(e,t){var n=e.holder(),o=e.editable();o.on("mousedown",l(n,"mousedown")),o.on("keyup mouseup",l(n,"update")),o.on("scroll",l(n,"scroll")),o.keypress(function(e){e.keyCode===ee.ENTER&&l(n,"enter").call(this,e)}),o.focus(l(n,"focus")),o.blur(l(n,"blur")),o.keyup(l(n,"keyup")),o.keydown(l(n,"keydown")),o.on("paste",l(n,"paste")),t.airMode||(e.toolbar().click(l(n,"toolbar.click")),e.popover().click(l(n,"popover.click"))),G.isMSIE?o.on("DOMCharacterDataModified DOMSubtreeModified DOMNodeInserted",l(n,"change")):o.on("input",l(n,"change")),Z.isTextarea(Y.head(n))&&n.closest("form").submit(function(e){var t=n.code();l(n,"submit").call(this,e,t)}),l(n,"init")();for(var i=0,r=T.summernote.plugins.length;i<r;i++)T.isFunction(T.summernote.plugins[i].init)&&T.summernote.plugins[i].init(e)},this.detach=function(e,t){e.holder().off(),e.editable().off(),e.popover().off(),e.handle().off(),e.dialog().off(),t.airMode||(e.dropzone().off(),e.toolbar().off(),e.statusbar().off())}};T.extend(T.summernote,{renderer:Ce,eventHandler:ye,core:{agent:G,dom:Z,range:X},pluginEvents:{},plugins:[]}),T.summernote.addPlugin=function(e){T.summernote.plugins.push(e),e.buttons&&T.each(e.buttons,function(e,t){Ce.addButtonInfo(e,t)}),e.dialogs&&T.each(e.dialogs,function(e,t){Ce.addDialogInfo(e,t)}),e.events&&T.each(e.events,function(e,t){T.summernote.pluginEvents[e]=t}),e.langs&&T.each(e.langs,function(e,t){T.summernote.lang[e]&&T.extend(T.summernote.lang[e],t)}),e.options&&T.extend(T.summernote.options,e.options)},T.fn.extend({summernote:function(){var e=T.type(Y.head(arguments)),t="string"===e,i="object"===e?Y.head(arguments):{};(i=T.extend(!0,{},T.summernote.options,i)).langInfo=T.extend(!0,{},T.summernote.lang["en-US"],T.summernote.lang[i.lang]),this.each(function(e,t){var n=T(t);if(!Ce.hasNoteEditor(n)){Ce.createLayout(n,i);var o=Ce.layoutInfoFromHolder(n);ye.attach(o,i),ye.attachCustomEvent(o,i)}}),!t&&this.length&&i.oninit&&i.oninit();var n=this.first();if(n.length){var o=Ce.layoutInfoFromHolder(n);if(t){var r=Y.head(Y.from(arguments)),a=Y.tail(Y.from(arguments)),s=[r,o.editable()].concat(a);return ye.invoke.apply(ye,s)}i.focus&&o.editable().focus()}return this},code:function(i){if(void 0!==i)return this.each(function(e,t){var n=Ce.layoutInfoFromHolder(T(t)),o=n&&n.editable();o&&o.html(i)}),this;var e=this.first();if(e.length){var t=Ce.layoutInfoFromHolder(e),n=t&&t.editable();if(n&&n.length){var o=ye.invoke("codeview.isActivated",t);return ye.invoke("codeview.sync",t),o?t.codable().val():t.editable().html()}return Z.isTextarea(e[0])?e.val():e.html()}},destroy:function(){return this.each(function(e,t){var n=T(t);if(Ce.hasNoteEditor(n)){var o=Ce.layoutInfoFromHolder(n),i=o.editor().data("options");ye.detach(o,i),Ce.removeLayout(n,o,i)}}),this}})});