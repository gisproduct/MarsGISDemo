/* 2018-7-31 19:52:41 | 版权所有 火星科技 http://marsgis.cn  【联系我们QQ：516584683，微信：marsgis】 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("leaflet"),require("esri-leaflet")):"function"==typeof define&&define.amd?define(["exports","leaflet","esri-leaflet"],t):t((e.L=e.L||{},e.L.esri=e.L.esri||{},e.L.esri.Cluster=e.L.esri.Cluster||{}),e.L,e.L.esri)}(this,function(e,a,t){"use strict";function r(e){return new s(e)}a="default"in a?a.default:a;var s=t.FeatureManager.extend({statics:{EVENTS:"click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose",CLUSTEREVENTS:"clusterclick clusterdblclick clustermouseover clustermouseout clustermousemove clustercontextmenu"},initialize:function(e){t.FeatureManager.prototype.initialize.call(this,e),e=a.setOptions(this,e),this._layers={},this._leafletIds={},this.cluster=a.markerClusterGroup(e),this._key="c"+(1e9*Math.random()).toString(36).replace(".","_"),this.cluster.addEventParent(this)},onAdd:function(e){t.FeatureManager.prototype.onAdd.call(this,e),this._map.addLayer(this.cluster)},onRemove:function(e){t.FeatureManager.prototype.onRemove.call(this,e),this._map.removeLayer(this.cluster)},createLayers:function(e){for(var t=[],r=e.length-1;0<=r;r--){var s=e[r];if(!this._layers[s.id]){var i=a.GeoJSON.geometryToLayer(s,this.options);i.feature=a.GeoJSON.asFeature(s),i.defaultOptions=i.options,i._leaflet_id=this._key+"_"+s.id,this.resetStyle(i.feature.id),this._layers[i.feature.id]=i,this._leafletIds[i._leaflet_id]=s.id,this.options.onEachFeature&&this.options.onEachFeature(i.feature,i),this.fire("createfeature",{feature:i.feature}),(!this.options.timeField||this.options.timeField&&this._featureWithinTimeRange(s))&&t.push(i)}}t.length&&this.cluster.addLayers(t)},addLayers:function(e){for(var t=[],r=e.length-1;0<=r;r--){var s=this._layers[e[r]];this.fire("addfeature",{feature:s.feature}),t.push(s)}this.cluster.addLayers(t)},removeLayers:function(e,t){for(var r=[],s=e.length-1;0<=s;s--){var i=e[s],a=this._layers[i];this.fire("removefeature",{feature:a.feature,permanent:t}),r.push(a),this._layers[i]&&t&&delete this._layers[i]}this.cluster.removeLayers(r)},resetStyle:function(e){var t=this._layers[e];return t&&(t.options=t.defaultOptions,this.setFeatureStyle(t.feature.id,this.options.style)),this},setStyle:function(t){return this.eachFeature(function(e){this.setFeatureStyle(e.feature.id,t)},this),this},setFeatureStyle:function(e,t){var r=this._layers[e];"function"==typeof t&&(t=t(r.feature)),r.setStyle&&r.setStyle(t)},eachFeature:function(e,t){for(var r in this._layers)e.call(t,this._layers[r]);return this},getFeature:function(e){return this._layers[e]}});e.FeatureLayer=s,e.featureLayer=r,e.default=r,e.VERSION="2.0.0"});